{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user profile within the Spotly application, mirroring the structure stored in Firestore.",
      "properties": {
        "walletAddress": {
          "type": "string",
          "description": "The Solana wallet address of the user, used as the unique identifier (document ID) in Firestore and the Firebase Auth uid."
        },
        "username": {
          "type": "string",
          "description": "The user's display name or username."
        },
        "role": {
          "type": "string",
          "description": "The user's role within the application ('regular', 'fan', 'artist', 'business').",
          "format": "string"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "profilePhotoUrl": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "bannerPhotoUrl": {
          "type": "string",
          "description": "URL of the user's banner photo.",
          "format": "uri"
        },
        "socialLinks": {
          "type": "string",
          "description": "JSON string containing links to the user's social media profiles.",
          "format": "string"
        },
        "extraLinks": {
          "type": "string",
          "description": "JSON string containing additional links provided by the user.",
          "format": "string"
        },
        "skills": {
          "type": "string",
          "description": "A comma-separated list of the user's skills."
        },
        "tags": {
          "type": "string",
          "description": "A comma-separated list of tags associated with the user."
        },
        "location": {
          "type": "string",
          "description": "The user's location."
        },
        "rankingScore": {
          "type": "number",
          "description": "A score representing the user's ranking on the platform."
        },
        "escrowBalance": {
          "type": "number",
          "description": "The user's current escrow balance."
        },
        "isBanned": {
          "type": "boolean",
          "description": "Indicates whether the user is banned from the platform."
        },
        "isSuspended": {
          "type": "boolean",
          "description": "Indicates whether the user's account is suspended."
        },
        "suspensionReason": {
          "type": "string",
          "description": "The reason for the user's suspension."
        },
        "warnings": {
          "type": "number",
          "description": "The number of warnings the user has received."
        },
        "adminNotes": {
          "type": "string",
          "description": "Notes added by administrators regarding the user."
        },
        "isDeleted": {
          "type": "boolean",
          "description": "Indicates whether the user's account is marked as deleted."
        },
        "talentCategory": {
          "type": "string",
          "description": "The primary talent category of the user (e.g., 'music', 'acting', 'creator')."
        },
        "talentSubcategories": {
          "type": "string",
          "description": "JSON string containing an array of subcategories related to the user's talent.",
          "format": "string"
        },
        "subRole": {
          "type": "string",
          "description": "A more specific role or sub-role of the user (e.g., 'singer', 'actor')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user's profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user's profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "walletAddress",
        "username",
        "role",
        "bio",
        "profilePhotoUrl",
        "bannerPhotoUrl"
      ]
    },
    "Video": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Video",
      "type": "object",
      "description": "Represents a video uploaded by an artist.",
      "properties": {
        "status": { "type": "string", "enum": ["active", "pending", "archived"], "description": "The status of the video." },
        "artistId": { "type": "string", "description": "The wallet address of the artist (Firebase Auth UID)." },
        "duration": { "type": "number", "description": "The duration of the video in seconds." },
        "isBanned": { "type": "boolean", "description": "Indicates if the video is banned." },
        "topCount": { "type": "number", "description": "The number of 'Top' votes." },
        "videoUrl": { "type": "string", "description": "Embeddable URL of the video.", "format": "uri" },
        "adminFlag": { "type": "boolean", "description": "Flag for admin review." },
        "banReason": { "type": "string", "description": "Reason for the ban." },
        "bookCount": { "type": "number", "description": "Number of times the artist was booked from this video." },
        "flopCount": { "type": "number", "description": "The number of 'Flop' votes." },
        "commentCount": { "type": "number", "description": "The number of comments on the video." },
        "shareCount": { "type": "number", "description": "The number of times the video has been shared." },
        "adoptCount": { "type": "number", "description": "Number of times this video was adopted." },
        "adminReason": { "type": "string", "description": "Reason for admin flag." },
        "rankingScore": { "type": "number", "description": "Score used for ranking the video." },
        "rawVideoInput": { "type": "string", "description": "Original user-provided URL for the video." },
        "videoCategory": { "type": "string", "description": "Category of the video (e.g., 'music', 'acting')." },
        "hiddenFromFeed": { "type": "boolean", "description": "Whether the video is hidden from the main feed." },
        "description": { "type": "string", "description": "The description of the video." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the video was created." },
        "updatedAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the video was last updated." }
      },
      "required": [
        "artistId",
        "videoUrl",
        "rawVideoInput",
        "videoCategory",
        "description",
        "createdAt",
        "updatedAt"
      ]
    },
    "GossipPost": {
      "title": "Gossip Post",
      "description": "A post in the gossip feed.",
      "type": "object",
      "properties": {
        "authorId": { "type": "string", "description": "The wallet address of the post author (Firebase Auth UID)." },
        "content": { "type": "string", "description": "The content of the post." },
        "commentsCount": { "type": "number", "description": "The number of comments on the post." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the post was created." }
      },
      "required": ["authorId", "content", "commentsCount", "createdAt"]
    },
    "GossipComment": {
      "title": "Gossip Comment",
      "description": "A comment on a gossip post.",
      "type": "object",
      "properties": {
        "postId": { "type": "string", "description": "The ID of the post being commented on." },
        "authorId": { "type": "string", "description": "The wallet address of the comment author (Firebase Auth UID)." },
        "content": { "type": "string", "description": "The content of the comment." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the comment was created." }
      },
      "required": ["postId", "authorId", "content", "createdAt"]
    },
    "GossipRating": {
      "title": "Gossip Rating",
      "description": "A rating on a gossip post.",
      "type": "object",
      "properties": {
        "postId": { "type": "string", "description": "The ID of the post being rated." },
        "raterId": { "type": "string", "description": "The wallet address of the rater (Firebase Auth UID)." },
        "rating": { "type": "number", "description": "The rating value." }
      },
      "required": ["postId", "raterId", "rating"]
    },
    "GossipUserFollow": {
        "title": "Gossip User Follow",
        "description": "Represents a user following another user.",
        "type": "object",
        "properties": {
            "followerId": { "type": "string", "description": "The wallet address of the follower (Firebase Auth UID)." },
            "followingId": { "type": "string", "description": "The wallet address of the user being followed." }
        },
        "required": ["followerId", "followingId"]
    },
    "GossipMessage": {
        "title": "Gossip Message",
        "description": "A private message between users.",
        "type": "object",
        "properties": {
            "fromId": { "type": "string", "description": "The wallet address of the sender (Firebase Auth UID)." },
            "toId": { "type": "string", "description": "The wallet address of the recipient." },
            "content": { "type": "string", "description": "The content of the message." },
            "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the message was sent." }
        },
        "required": ["fromId", "toId", "content", "createdAt"]
    },
    "GossipServiceAd": {
        "title": "Gossip Service Ad",
        "description": "A sponsored ad in the gossip feed.",
        "type": "object",
        "properties": {
            "title": { "type": "string", "description": "The title of the ad." },
            "content": { "type": "string", "description": "The content of the ad." },
            "imageUrl": { "type": "string", "format": "uri", "description": "URL of the ad image." },
            "targetUrl": { "type": "string", "format": "uri", "description": "URL the ad links to." }
        },
        "required": ["title", "content", "imageUrl", "targetUrl"]
    },
    "MarketplaceProduct": {
        "title": "Marketplace Product",
        "description": "A product listed for sale in the marketplace.",
        "type": "object",
        "properties": {
            "sellerId": { "type": "string", "description": "The wallet address of the seller (Firebase Auth UID)." },
            "name": { "type": "string", "description": "The name of the product." },
            "description": { "type": "string", "description": "The description of the product." },
            "price": { "type": "number", "description": "The price of the product." },
            "stock": { "type": "number", "description": "The available stock of the product." },
            "status": { "type": "string", "enum": ["active", "inactive", "sold_out"], "description": "The status of the product." },
            "imageUrl": { "type": "string", "format": "uri", "description": "URL of the product image." },
            "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the product was created." }
        },
        "required": ["sellerId", "name", "price", "stock", "status", "imageUrl", "createdAt"]
    },
    "MarketplaceOrder": {
        "title": "Marketplace Order",
        "description": "An order placed in the marketplace.",
        "type": "object",
        "properties": {
            "buyerId": { "type": "string", "description": "The wallet address of the buyer (Firebase Auth UID)." },
            "sellerId": { "type": "string", "description": "The wallet address of the seller." },
            "productId": { "type": "string", "description": "The ID of the product being ordered." },
            "quantity": { "type": "number", "description": "The quantity of the product ordered." },
            "totalPrice": { "type": "number", "description": "The total price of the order." },
            "status": { "type": "string", "enum": ["pending", "processing", "shipped", "completed", "disputed", "refunded"], "description": "The status of the order." },
            "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the order was created." }
        },
        "required": ["buyerId", "sellerId", "productId", "quantity", "totalPrice", "status", "createdAt"]
    },
    "MarketplaceReview": {
        "title": "Marketplace Review",
        "description": "A review for a product in the marketplace.",
        "type": "object",
        "properties": {
            "productId": { "type": "string", "description": "The ID of the product being reviewed." },
            "buyerId": { "type": "string", "description": "The wallet address of the reviewer (Firebase Auth UID)." },
            "rating": { "type": "number", "description": "The rating value (1-5)." },
            "comment": { "type": "string", "description": "The content of the review." },
            "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the review was created." }
        },
        "required": ["productId", "buyerId", "rating", "comment", "createdAt"]
    },
    "Notification": {
      "title": "Notification",
      "description": "Represents a user notification.",
      "type": "object",
      "properties": {
        "recipientWallet": { "type": "string", "description": "The wallet address of the user who receives the notification." },
        "message": { "type": "string", "description": "The notification message content." },
        "type": { "type": "string", "description": "The type of notification (e.g., 'tip', 'booking', 'follow')." },
        "read": { "type": "boolean", "description": "Indicates if the notification has been read." },
        "relatedId": { "type": "string", "description": "ID of the related entity (e.g., booking ID, message ID)." },
        "senderWallet": { "type": "string", "description": "The wallet address of the user who triggered the notification." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the notification was created." },
        "data": { "type": "string", "description": "JSON string containing additional data for the notification." }
      },
      "required": ["recipientWallet", "message", "type", "read", "createdAt"]
    },
    "Tip": {
      "title": "Tip",
      "description": "Represents a tip from one user to another.",
      "type": "object",
      "properties": {
        "amount": { "type": "number", "description": "The amount of the tip." },
        "videoId": { "type": "string", "description": "The ID of the video being tipped for." },
        "toWallet": { "type": "string", "description": "The wallet address of the artist receiving the tip." },
        "fromWallet": { "type": "string", "description": "The wallet address of the user giving the tip." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the tip was created." }
      },
      "required": ["amount", "videoId", "toWallet", "fromWallet", "createdAt"]
    },
    "UserVote": {
      "title": "User Vote",
      "description": "Represents a Top or Flop vote on a video by a user.",
      "type": "object",
      "properties": {
        "videoId": { "type": "string", "description": "The ID of the video being voted on." },
        "userId": { "type": "string", "description": "The ID of the user who voted." },
        "isPositive": { "type": "boolean", "description": "True for a 'Top' vote, false for a 'Flop' vote." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the vote was cast." }
      },
      "required": ["videoId", "userId", "isPositive", "createdAt"]
    },
    "Favorite": {
      "title": "Favorite",
      "description": "Represents a user's favorited item (video or product).",
      "type": "object",
      "properties": {
        "itemId": { "type": "string", "description": "The ID of the favorited item (e.g., videoId, productId)." },
        "itemType": { "type": "string", "enum": ["video", "product"], "description": "The type of the favorited item." },
        "userId": { "type": "string", "description": "The ID of the user who favorited the item." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the item was favorited." }
      },
      "required": ["itemId", "itemType", "userId", "createdAt"]
    },
     "Warning": {
      "title": "Warning",
      "description": "A warning issued to a user by an admin.",
      "type": "object",
      "properties": {
        "userId": { "type": "string", "description": "The ID of the user receiving the warning." },
        "reason": { "type": "string", "description": "The reason for the warning." },
        "adminId": { "type": "string", "description": "The ID of the admin who issued the warning." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the warning was created." }
      },
      "required": ["userId", "reason", "adminId", "createdAt"]
    },
    "AdminAd": {
      "title": "Admin Ad",
      "description": "An advertisement created by an admin.",
      "type": "object",
      "properties": {
        "title": { "type": "string", "description": "The title of the ad." },
        "content": { "type": "string", "description": "The content of the ad." },
        "imageUrl": { "type": "string", "format": "uri", "description": "URL of the ad image." },
        "targetUrl": { "type": "string", "format": "uri", "description": "URL the ad links to." },
        "isActive": { "type": "boolean", "description": "Whether the ad is currently active." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the ad was created." }
      },
      "required": ["title", "content", "targetUrl", "isActive", "createdAt"]
    },
    "Referral": {
      "title": "Referral",
      "description": "Represents a user referral.",
      "type": "object",
      "properties": {
        "referrerWallet": { "type": "string", "description": "The wallet address of the user who referred someone." },
        "referredWallet": { "type": "string", "description": "The wallet address of the user who was referred." },
        "rewardAmount": { "type": "number", "description": "The amount of the reward given for the referral." },
        "rewardStatus": { "type": "string", "enum": ["pending", "paid"], "description": "The status of the referral reward." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp of when the referral was created." }
      },
      "required": ["referrerWallet", "referredWallet", "rewardAmount", "rewardStatus", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{walletAddress}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The 'walletAddress' serves as both the document ID and the Firebase Auth UID (Solana public key), ensuring direct ownership and simplifying security rules. Includes all user profile data as defined in the provided schema.",
          "params": [
            {
              "name": "walletAddress",
              "description": "The Solana wallet address of the user, functioning as the document ID and Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/videos/{videoId}",
        "definition": {
          "entityName": "Video",
          "schema": {
            "$ref": "#/backend/entities/Video"
          },
          "description": "Stores video data. Each document is a unique video.",
          "params": [
            {
              "name": "videoId",
              "description": "The auto-generated ID for the video document."
            }
          ]
        }
      },
      {
          "path": "/gossip_posts/{postId}",
          "definition": {
              "entityName": "GossipPost",
              "schema": { "$ref": "#/backend/entities/GossipPost" },
              "description": "Stores individual posts for the gossip feed."
          }
      },
      {
          "path": "/gossip_comments/{commentId}",
          "definition": {
              "entityName": "GossipComment",
              "schema": { "$ref": "#/backend/entities/GossipComment" },
              "description": "Stores comments for gossip posts."
          }
      },
      {
          "path": "/gossip_ratings/{ratingId}",
          "definition": {
              "entityName": "GossipRating",
              "schema": { "$ref": "#/backend/entities/GossipRating" },
              "description": "Stores ratings for gossip posts."
          }
      },
      {
          "path": "/gossip_user_follows/{followId}",
          "definition": {
              "entityName": "GossipUserFollow",
              "schema": { "$ref": "#/backend/entities/GossipUserFollow" },
              "description": "Tracks user follow relationships."
          }
      },
      {
          "path": "/gossip_messages/{messageId}",
          "definition": {
              "entityName": "GossipMessage",
              "schema": { "$ref": "#/backend/entities/GossipMessage" },
              "description": "Stores private messages between users."
          }
      },
      {
          "path": "/gossip_service_ads/{adId}",
          "definition": {
              "entityName": "GossipServiceAd",
              "schema": { "$ref": "#/backend/entities/GossipServiceAd" },
              "description": "Stores sponsored ads for the gossip feed."
          }
      },
      {
          "path": "/marketplace_products/{productId}",
          "definition": {
              "entityName": "MarketplaceProduct",
              "schema": { "$ref": "#/backend/entities/MarketplaceProduct" },
              "description": "Stores products listed in the marketplace."
          }
      },
      {
          "path": "/marketplace_orders/{orderId}",
          "definition": {
              "entityName": "MarketplaceOrder",
              "schema": { "$ref": "#/backend/entities/MarketplaceOrder" },
              "description": "Stores orders placed in the marketplace."
          }
      },
      {
          "path": "/marketplace_reviews/{reviewId}",
          "definition": {
              "entityName": "MarketplaceReview",
              "schema": { "$ref": "#/backend/entities/MarketplaceReview" },
              "description": "Stores reviews for products in the marketplace."
          }
      },
      {
        "path": "/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": { "$ref": "#/backend/entities/Notification" },
          "description": "Stores user notifications for various events."
        }
      },
       {
        "path": "/tips/{tipId}",
        "definition": {
          "entityName": "Tip",
          "schema": { "$ref": "#/backend/entities/Tip" },
          "description": "Stores tips from users to artists."
        }
      },
      {
        "path": "/user_votes/{voteId}",
        "definition": {
          "entityName": "UserVote",
          "schema": { "$ref": "#/backend/entities/UserVote" },
          "description": "Stores individual user votes on videos to prevent duplicate voting."
        }
      },
      {
        "path": "/favorites/{favoriteId}",
        "definition": {
          "entityName": "Favorite",
          "schema": { "$ref": "#/backend/entities/Favorite" },
          "description": "Stores items favorited by users."
        }
      },
      {
        "path": "/warnings/{warningId}",
        "definition": {
          "entityName": "Warning",
          "schema": { "$ref": "#/backend/entities/Warning" },
          "description": "Stores warnings issued to users by administrators."
        }
      },
      {
        "path": "/admin_ads/{adId}",
        "definition": {
          "entityName": "AdminAd",
          "schema": { "$ref": "#/backend/entities/AdminAd" },
          "description": "Stores advertisements created by administrators."
        }
      },
      {
        "path": "/referrals/{referralId}",
        "definition": {
          "entityName": "Referral",
          "schema": { "$ref": "#/backend/entities/Referral" },
          "description": "Stores user referral data."
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to manage user authentication, profiles and videos using Firebase, focusing on replacing the existing Devbase user management system with Firebase Auth and Firestore. It prioritizes Authorization Independence by avoiding hierarchical `get()` calls in security rules. The `users` collection stores user profiles, with the document ID matching the Firebase Auth `uid` (Solana wallet address), ensuring direct access and simplifying security rules based on user ownership. The `videos` collection stores all video data, with `artistId` linking back to a user. All data in `users` and `videos` collections have the same security requirements. The structure enables secure `list` operations (QAPs) by storing user and video data directly in their respective collections, avoiding the need to filter based on parent document data.  Specifically, this structure avoids hierarchical dependencies, enabling atomic operations. Roles are stored directly in the database (DBAC), relying solely on `request.auth.uid` for authorization."
  }
}
